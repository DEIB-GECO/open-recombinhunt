2025-08-30 16:30:33,635 - INFO - Logging initialized. Log file at: logs/20250830_163033_yellow-fever_pipeline_run.log
2025-08-30 16:30:33,635 - INFO - ================== STARTING PIPELINE FOR: YELLOW-FEVER ==================
2025-08-30 16:30:33,635 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python src/01_data_acquisition/fetch_data.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:30:38,383 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250830_163033_yellow-fever_01_fetch_data.log
INFO: Ensuring raw data directory exists: data/raw/yellow-fever
INFO: Starting NCBI data acquisition via CLI...
INFO: Step 1: Downloading main dataset...
INFO: Executing: datasets download virus genome taxon 11089 --include genome --filename yellow-fever-download.zip
INFO: Unzipping data/raw/yellow-fever/temp_complete_download/yellow-fever-download.zip...
INFO: Executing: dataformat tsv virus-genome --inputfile ncbi_dataset/data/data_report.jsonl > yellow-fever-raw-metadata.tsv
INFO: Found: data/raw/yellow-fever/temp_complete_download/ncbi_dataset/data/genomic.fna. Moving and renaming to data/raw/yellow-fever/raw_sequences.fasta
INFO: Found: data/raw/yellow-fever/temp_complete_download/yellow-fever-raw-metadata.tsv. Moving and renaming to data/raw/yellow-fever/raw_metadata.tsv
INFO: Step 3: Cleaning up temporary files...
INFO: Cleanup complete.
INFO: Step 2: Downloading reference sequence...
INFO: Fetching reference sequence from NCBI...
INFO: Executing: datasets download virus genome accession NC_002031.1 --include genome --filename yellow-fever-reference.zip
INFO: Unzipping data/raw/yellow-fever/temp_ref_download/yellow-fever-reference.zip...
INFO: Found: data/raw/yellow-fever/temp_ref_download/ncbi_dataset/data/genomic.fna. Moving and renaming to data/raw/yellow-fever/reference.fasta
INFO: Cleaning up temporary reference sequence files...
INFO: Data fetching process for 'yellow-fever' complete.

2025-08-30 16:30:38,384 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python src/01_data_acquisition/fetch_data.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:30:38,384 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python src/02_preprocessing/ncbi/prep_metadata_ncbi.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:30:39,129 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250830_163039_yellow-fever_02.1_prep_metadata_ncbi.log
INFO: Loading raw metadata from data/raw/yellow-fever/raw_metadata.tsv...
INFO: Step 1: Applying quality filters from config and checking for special characters in ID...
INFO:   Filter 'Isolate Collection date notna None': Removed 608 rows.
INFO:   Filter 'Accession notna None': Removed 0 rows.
INFO:   Filter 'Length notna None': Removed 0 rows.
INFO:   Filter 'Length >= 9775': Removed 270 rows.
INFO:   Filter 'Special Chars in ID': Removed 0 rows.
INFO: Step 2: Processing lineage column...
INFO: No source lineage column specified ('NONE'). Assigning default lineage 'A.1' to all rows.
INFO: Step 3: Performing final formatting on date and location columns...
INFO: Formatting date columns...
INFO:   - Analyzing and formatting 'Collection date'
INFO:     Date format statistics for 'Collection date':
INFO:       YYYY-MM-DD format: 1226
INFO:       YYYY-MM format   : 40
INFO:       YYYY format      : 142
INFO:       Other/unparseable: 0
INFO:       Missing (NA)     : 0
INFO:   - Analyzing and formatting 'Submission date'
INFO:     Date format statistics for 'Submission date':
INFO:       YYYY-MM-DD format: 0
INFO:       YYYY-MM format   : 0
INFO:       YYYY format      : 0
INFO:       Other/unparseable: 1408
INFO:       Missing (NA)     : 0
INFO: Formatting 'Location' column by combining 'Geographic Region' and 'Geographic Location'...
INFO: Preprocessing complete. Final dataset has 1408 rows.
INFO: Saving processed metadata (1408 rows) to data/processed/yellow-fever/metadata.tsv...
INFO: Saving 878 quality-filtered sequence IDs to data/processed/yellow-fever/filtered_sequence_ids.txt...
INFO: Saving 0 non-classified sequence IDs to data/processed/yellow-fever/non_classified_sequence_ids.txt...
INFO: Script finished successfully.

2025-08-30 16:30:39,130 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python src/02_preprocessing/ncbi/prep_metadata_ncbi.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:30:39,130 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python src/02_preprocessing/common/prep_fasta.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:30:39,723 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250830_163039_yellow-fever_02.2_prep_fasta.log
INFO: Loading IDs of sequences to be dropped...
INFO: Loading IDs from: data/processed/yellow-fever/filtered_sequence_ids.txt
INFO: Loaded 878 unique IDs.
INFO: Loading IDs from: data/processed/yellow-fever/non_classified_sequence_ids.txt
INFO: Loaded 0 unique IDs.
INFO: NUmber of Filtered IDs: 878
INFO: Number of Non-Classified IDs: 0
INFO: Total unique IDs to drop from FASTA file: 878
INFO: Filtering FASTA file: data/raw/yellow-fever/raw_sequences.fasta...
INFO: Removing sequences whose ID is in the combined dropped list (878 total IDs).
INFO: FASTA Filtering Summary:
INFO:   Original sequences read: 2286
INFO:   Sequences dropped      : 878
INFO:   Sequences kept         : 1408
INFO: Filtered FASTA saved to  : data/processed/yellow-fever/sequences.fasta
INFO: Script finished successfully.

2025-08-30 16:30:39,723 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python src/02_preprocessing/common/prep_fasta.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:30:39,723 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python src/02_preprocessing/common/prep_ref.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:30:39,832 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250830_163039_yellow-fever_02.3_prep_ref.log
INFO: Copying reference sequence...
INFO:   Source: data/raw/yellow-fever/reference.fasta
INFO:   Destination: data/processed/yellow-fever/reference.fasta
INFO: Reference sequence successfully copied to processed directory.
INFO: Script finished successfully.

2025-08-30 16:30:39,832 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python src/02_preprocessing/common/prep_ref.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:30:39,832 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python src/03_haplocov/run_haplocov.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:30:55,324 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250830_163039_yellow-fever_03_run_haplocov.log
INFO: --- Starting Step 3: Run HaploCoV for 'yellow-fever' ---
INFO: Created temporary working directory: results/haplocov_output/yellow-fever/dist3size10/temp_work
INFO: Creating symbolic links for input files in temporary directory...
INFO: Executing HaploCoV with designation_mode: 'haplocov'
INFO: Executing: perl ../../../../../libs/haplocov/addToTableNCBI.pl --metadata metadata.tsv --ref reference.fasta --seq sequences.fasta --outfile out.HaploCoV --nproc 16
INFO: Executing: perl ../../../../../libs/haplocov/computeDefining.pl out.HaploCoV
INFO: Executing: perl ../../../../../libs/haplocov/assign.pl --dfile out.HaploCoV.definingVariants.txt --infile out.HaploCoV --outfile out.HaploCoV.assigned
INFO: Executing: perl ../../../../../libs/haplocov/augmentClusters.pl --metafile out.HaploCoV.assigned --deffile out.HaploCoV.definingVariants.txt --posFile out.HaploCoV.frequentVariants.txt --outfile out.HaploCoV.definingVariantsNew.txt --dist 3 --size 10
INFO: Executing: perl ../../../../../libs/haplocov/assign.pl --dfile out.HaploCoV.definingVariantsNew.txt --infile out.HaploCoV --outfile out.HaploCoV.assignedNew
INFO: Executing: cut -f 10 out.HaploCoV.assignedNew | sort | uniq -c > yellow-fever-report.txt
INFO: Moving final output file 'out.HaploCoV.assignedNew' to 'results/haplocov_output/yellow-fever/dist3size10/haplocov_assigned.tsv'
INFO: HaploCoV step completed.
INFO: HaploCoV step finished successfully.

2025-08-30 16:30:55,324 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python src/03_haplocov/run_haplocov.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:30:55,324 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python src/04_postprocessing/format_haplocov_variations.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:30:57,322 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250830_163055_yellow-fever_04_postprocess_haplocov.log
INFO: Loading HaploCoV output from: results/haplocov_output/yellow-fever/dist3size10/haplocov_assigned.tsv
INFO: Reformatting mutations in the 'listV' column...
INFO: Saving reformatted data to: results/haplocov_output/yellow-fever/dist3size10/haplocov_reformatted.tsv
INFO: Script finished successfully.

2025-08-30 16:30:57,322 - WARNING - Stderr from step:

Formatting mutations:   0%|          | 0/1407 [00:00<?, ?it/s]
Formatting mutations:  12%|█▏        | 163/1407 [00:00<00:00, 1623.99it/s]
Formatting mutations:  23%|██▎       | 328/1407 [00:00<00:00, 1638.69it/s]
Formatting mutations:  35%|███▍      | 492/1407 [00:00<00:00, 1633.66it/s]
Formatting mutations:  47%|████▋     | 656/1407 [00:00<00:00, 1622.18it/s]
Formatting mutations:  58%|█████▊    | 821/1407 [00:00<00:00, 1631.25it/s]
Formatting mutations:  70%|███████   | 987/1407 [00:00<00:00, 1638.80it/s]
Formatting mutations:  88%|████████▊ | 1245/1407 [00:00<00:00, 1944.39it/s]
Formatting mutations: 100%|██████████| 1407/1407 [00:00<00:00, 1780.47it/s]

2025-08-30 16:30:57,322 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python src/04_postprocessing/format_haplocov_variations.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:30:57,322 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python src/05_prepare_recombinhunt/create_environment.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:30:59,362 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250830_163057_yellow-fever_05.1_create_environment.log
INFO: Virus is 'yellow-fever'. Using HaploCoV reformatted output as input.
INFO: Environment files will be saved to: environments/yellow-fever/dist3size10
INFO: Loading data from: results/haplocov_output/yellow-fever/dist3size10/haplocov_reformatted.tsv
INFO: Initial row count: 1,407
INFO: Row count after cleaning: 1,407
INFO: Calculating change probabilities...
INFO:   Total sequences for calculation: 1,407
INFO:   Found 7,609 unique mutations across all sequences.
INFO:   Finished calculating change probabilities. Shape of result: (7609, 2)
INFO: Calculating genome and variation counts per lineage...
INFO:   Found 3 unique lineages in the dataset.
INFO:   Finished calculating genome and variation counts.
INFO: 
Calculating 'lc_df.parquet'...
INFO: 
--- Running common logic: calculating lineage mutation frequencies ---
INFO: Selected 3 lineages with at least 10 genomes.
INFO: Removed 0 mutations that were not characteristic of any lineage.
INFO: lc_df calculation complete.
INFO: 
Calculating 'change2lineage_probability.parquet'...
INFO: 
--- Running common logic: calculating lineage mutation frequencies ---
INFO: Selected 3 lineages with at least 10 genomes.
INFO: change2lineage_probability calculation complete.
INFO: 
Calculating 'lc_quality_df.parquet'...
INFO: lc_quality_df calculation complete.
INFO: Saving environment files...
INFO: Environment creation complete.

2025-08-30 16:30:59,363 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python src/05_prepare_recombinhunt/create_environment.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:30:59,363 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python src/05_prepare_recombinhunt/create_samples.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:31:00,605 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250830_163059_yellow-fever_05.2_create_samples.log
INFO: --- Starting Step 5.2: Create Samples for 'yellow-fever' ---
INFO: Virus is 'yellow-fever'. Using HaploCoV reformatted output as input.
INFO: Sample files will be saved to: samples/yellow-fever/dist3size10
INFO: Loading data from: results/haplocov_output/yellow-fever/dist3size10/haplocov_reformatted.tsv
INFO: Cleaning data by dropping rows with missing pangoLin or mutations...
INFO: Initially, there were 1407 rows.
INFO: Data cleaning complete. 1407 rows remaining for sample creation.
INFO: Grouping by lineage and creating sample files...
INFO:   Saved: samples/yellow-fever/dist3size10/samples_A.1.csv (835 rows)
INFO:   Saved: samples/yellow-fever/dist3size10/samples_A.1.NmC1.csv (377 rows)
INFO:   Saved: samples/yellow-fever/dist3size10/samples_A.1.NmC2.csv (195 rows)
INFO: Saving lineage count summary to: samples/yellow-fever/dist3size10/samples_total.json
INFO: Sample creation step finished successfully.

2025-08-30 16:31:00,605 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python src/05_prepare_recombinhunt/create_samples.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:31:00,605 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python src/06_recombinhunt/run_recombinhunt.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:31:49,315 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250830_163101_yellow-fever_06_run_recombinhunt.log
INFO: --- Starting Step 6: Run RecombinHunt for 'yellow-fever' ---
INFO: Loading RecombinHunt environment from: environments/yellow-fever/dist3size10
Starting formal checks of the environment...
INFO: Loading lineage totals from 'samples/yellow-fever/dist3size10/samples_total.json'
INFO: Found 3 sample files in 'samples/yellow-fever/dist3size10'.
INFO:   Lineage 'A.1.NmC2', Mode 'all': Processing all 195 samples.
INFO:   Lineage 'A.1.NmC1', Mode 'all': Processing all 377 samples.
INFO:   Lineage 'A.1', Mode 'all': Processing all 835 samples.
WARNING: Gap made of only target mutations (How can it be? It's an almost impossible condition). Target mutation that minimizes the loss has been assigned to the right region).
WARNING: Gap made of only target mutations (How can it be? It's an almost impossible condition). Target mutation that minimizes the loss has been assigned to the right region).
WARNING: Gap made of only target mutations (How can it be? It's an almost impossible condition). Target mutation that minimizes the loss has been assigned to the right region).
WARNING: Gap made of only target mutations (How can it be? It's an almost impossible condition). Target mutation that minimizes the loss has been assigned to the right region).
WARNING: Gap made of only target mutations (How can it be? It's an almost impossible condition). Target mutation that minimizes the loss has been assigned to the right region).
ERROR:   Error on one sample in lineage A.1: Reindexing only valid with uniquely valued Index objects
Traceback (most recent call last):
  File "/home/topcuoglu/openrecombinhunt/src/06_recombinhunt/run_recombinhunt.py", line 162, in run_recombinhunt_for_lineage
    experiment.set_target(nuc_change_data_list)
  File "/home/topcuoglu/openrecombinhunt/libs/recombinhunt-cov-7.0.0/src/recombinhunt/core/method.py", line 567, in set_target
    self.merged_df = self.env.make_merged_df(seq_df)
  File "/home/topcuoglu/openrecombinhunt/libs/recombinhunt-cov-7.0.0/src/recombinhunt/core/environment.py", line 104, in make_merged_df
    target_and_not_lc_df = pd.concat([
  File "/home/topcuoglu/.local/lib/python3.10/site-packages/pandas/core/reshape/concat.py", line 393, in concat
    return op.get_result()
  File "/home/topcuoglu/.local/lib/python3.10/site-packages/pandas/core/reshape/concat.py", line 676, in get_result
    indexers[ax] = obj_labels.get_indexer(new_labels)
  File "/home/topcuoglu/.local/lib/python3.10/site-packages/pandas/core/indexes/base.py", line 3874, in get_indexer
    raise InvalidIndexError(self._requires_unique_msg)
pandas.errors.InvalidIndexError: Reindexing only valid with uniquely valued Index objects
ERROR:   Error on one sample in lineage A.1: Reindexing only valid with uniquely valued Index objects
Traceback (most recent call last):
  File "/home/topcuoglu/openrecombinhunt/src/06_recombinhunt/run_recombinhunt.py", line 162, in run_recombinhunt_for_lineage
    experiment.set_target(nuc_change_data_list)
  File "/home/topcuoglu/openrecombinhunt/libs/recombinhunt-cov-7.0.0/src/recombinhunt/core/method.py", line 567, in set_target
    self.merged_df = self.env.make_merged_df(seq_df)
  File "/home/topcuoglu/openrecombinhunt/libs/recombinhunt-cov-7.0.0/src/recombinhunt/core/environment.py", line 104, in make_merged_df
    target_and_not_lc_df = pd.concat([
  File "/home/topcuoglu/.local/lib/python3.10/site-packages/pandas/core/reshape/concat.py", line 393, in concat
    return op.get_result()
  File "/home/topcuoglu/.local/lib/python3.10/site-packages/pandas/core/reshape/concat.py", line 676, in get_result
    indexers[ax] = obj_labels.get_indexer(new_labels)
  File "/home/topcuoglu/.local/lib/python3.10/site-packages/pandas/core/indexes/base.py", line 3874, in get_indexer
    raise InvalidIndexError(self._requires_unique_msg)
pandas.errors.InvalidIndexError: Reindexing only valid with uniquely valued Index objects
ERROR:   Error on one sample in lineage A.1: Reindexing only valid with uniquely valued Index objects
Traceback (most recent call last):
  File "/home/topcuoglu/openrecombinhunt/src/06_recombinhunt/run_recombinhunt.py", line 162, in run_recombinhunt_for_lineage
    experiment.set_target(nuc_change_data_list)
  File "/home/topcuoglu/openrecombinhunt/libs/recombinhunt-cov-7.0.0/src/recombinhunt/core/method.py", line 567, in set_target
    self.merged_df = self.env.make_merged_df(seq_df)
  File "/home/topcuoglu/openrecombinhunt/libs/recombinhunt-cov-7.0.0/src/recombinhunt/core/environment.py", line 104, in make_merged_df
    target_and_not_lc_df = pd.concat([
  File "/home/topcuoglu/.local/lib/python3.10/site-packages/pandas/core/reshape/concat.py", line 393, in concat
    return op.get_result()
  File "/home/topcuoglu/.local/lib/python3.10/site-packages/pandas/core/reshape/concat.py", line 676, in get_result
    indexers[ax] = obj_labels.get_indexer(new_labels)
  File "/home/topcuoglu/.local/lib/python3.10/site-packages/pandas/core/indexes/base.py", line 3874, in get_indexer
    raise InvalidIndexError(self._requires_unique_msg)
pandas.errors.InvalidIndexError: Reindexing only valid with uniquely valued Index objects
INFO: Recombinant summary saved to: results/recombinhunt_output/yellow-fever/dist3size10/recombinant_summary.tsv
INFO: Saved extensive summary table to: results/recombinhunt_output/yellow-fever/dist3size10/recombinant_summary_extensive.tsv
INFO: Text report saved to: results/recombinhunt_output/yellow-fever/dist3size10/experiment-output.all.txt
INFO: HTML report saved to: results/recombinhunt_output/yellow-fever/dist3size10/experiment-detail.all.html
INFO: RecombinHunt experiment step finished successfully.

2025-08-30 16:31:49,315 - WARNING - Stderr from step:
/home/topcuoglu/openrecombinhunt/libs/recombinhunt-cov-7.0.0/src/recombinhunt/core/environment.py:237: UserWarning: RecombinHunt 5.+ expects a candidates_hierarchy.json in the environment dir but the file is missing. Backward compatibility is possible by calling Environment.embed_candidates_hierarchy() with a CandidatesHierarchy object. Resorting to default CandidatesHierarchy.
  warnings.warn("RecombinHunt 5.+ expects a candidates_hierarchy.json in the environment dir but the file is missing. Backward compatibility is possible by"

Running Experiments:   0%|          | 0/3 [00:00<?, ?it/s]
Running Experiments:  33%|███▎      | 1/3 [00:05<00:10,  5.05s/it]
Running Experiments:  67%|██████▋   | 2/3 [00:16<00:08,  8.84s/it]
Running Experiments: 100%|██████████| 3/3 [00:47<00:00, 18.90s/it]
Running Experiments: 100%|██████████| 3/3 [00:47<00:00, 15.81s/it]

2025-08-30 16:31:49,316 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python src/06_recombinhunt/run_recombinhunt.py --virus yellow-fever --config config/config.yaml ---
2025-08-30 16:31:49,316 - INFO - ================== PIPELINE FOR YELLOW-FEVER FINISHED ==================


