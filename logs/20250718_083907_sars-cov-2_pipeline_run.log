2025-07-18 08:39:07,388 - INFO - Logging initialized. Log file at: logs/20250718_083907_sars-cov-2_pipeline_run.log
2025-07-18 08:39:07,388 - INFO - ================== STARTING PIPELINE FOR: SARS-COV-2 ==================
2025-07-18 08:39:07,388 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python3 src/02_preprocessing/nextstrain/prep_metadata_nextstrain.py --virus sars-cov-2 --config config/config.yaml ---
2025-07-18 08:48:21,508 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250718_083908_sars-cov-2_02.1_prep_metadata_nextstrain.log
INFO: Loading raw metadata from data/raw/sars-cov-2/raw_metadata.tsv...
INFO: Starting preprocessing of Nextstrain metadata with 9351099 rows.
INFO: Step 1: Applying quality filters from config...
INFO:   Filter 'missing_data < 589': Removed 1931672 rows.
INFO:   Filter 'coverage >= 0.99': Removed 1914663 rows.
INFO:   Filter 'virus == ncov': Removed 0 rows.
INFO:   Filter 'virus notna None': Removed 0 rows.
INFO:   Filter 'length notna None': Removed 0 rows.
INFO:   Filter 'date_submitted notna None': Removed 0 rows.
INFO:   Filter 'QC_overall_status notna None': Removed 0 rows.
INFO:   Filter 'QC_overall_status != bad': Removed 143624 rows.
INFO:   Filter 'QC_missing_data == good': Removed 0 rows.
INFO:   Filter 'QC_frame_shifts == good': Removed 71750 rows.
INFO:   Filter 'QC_stop_codons == good': Removed 8760 rows.
INFO:   Filter 'QC_mixed_sites == good': Removed 258033 rows.
INFO: Step 3: Processing lineage column...
INFO: Using source column 'pango_lineage' for lineage information.
INFO:   Identified and removed 0 non-classified rows (missing 'pango_lineage').
INFO: Step 4: Performing final formatting...
INFO: Formatting date columns...
INFO:   - Analyzing and formatting 'Collection date'
INFO:     Removed 423 rows with incomplete 'XXXX' dates.
INFO:     Date format statistics for 'Collection date':
INFO:       YYYY-MM-DD format: 4992986
INFO:       YYYY-MM format   : 17740
INFO:       YYYY format      : 10813
INFO:       Other/unparseable: 624
INFO:       Missing (NA)     : 11
INFO:   - Analyzing and formatting 'Submission date'
INFO:     Date format statistics for 'Submission date':
INFO:       YYYY-MM-DD format: 5022174
INFO:       YYYY-MM format   : 0
INFO:       YYYY format      : 0
INFO:       Other/unparseable: 0
INFO:       Missing (NA)     : 0
INFO: Formatting 'Location' column by combining 'region' and 'country'...
INFO: Preprocessing complete. Final dataset has 5022174 rows.
INFO: Saving processed metadata (5022174 rows) to data/processed/sars-cov-2/metadata.tsv...
INFO: Saving 4328925 quality-filtered sequence IDs to data/processed/sars-cov-2/filtered_sequence_ids.txt...
INFO: Saving 0 non-classified sequence IDs to data/processed/sars-cov-2/non_classified_sequence_ids.txt...
INFO: Script finished successfully.

2025-07-18 08:48:21,509 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python3 src/02_preprocessing/nextstrain/prep_metadata_nextstrain.py --virus sars-cov-2 --config config/config.yaml ---
2025-07-18 08:48:21,509 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python3 src/04_postprocessing/format_covid_variations.py --virus sars-cov-2 --config config/config.yaml ---
2025-07-18 09:02:37,777 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250718_084822_sars-cov-2_04_format_covid_variations.log
INFO: Loading processed metadata from: data/processed/sars-cov-2/metadata.tsv
INFO: Starting transformation of mutation columns...
INFO: Processing 'substitutions'...
INFO: Processing 'deletions'...
INFO: Processing 'insertions'...
INFO: Combining transformed columns into 'mutations' column...
INFO: Mutation processing complete.
INFO: Validating intermediate column formats...
INFO: All format assertions passed successfully!
INFO: Dropping intermediate and original mutation columns...
INFO: Renaming 'Pango lineage' column to 'pangoLin' for consistency...
INFO: Saving reformatted data with 5022174 rows to: results/nextstrain_output/sars-cov-2/nextstrain_reformatted.tsv
INFO: Script finished successfully.

2025-07-18 09:02:37,777 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python3 src/04_postprocessing/format_covid_variations.py --virus sars-cov-2 --config config/config.yaml ---
2025-07-18 09:02:37,777 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python3 src/05_prepare_recombinhunt/create_environment.py --virus sars-cov-2 --config config/config.yaml ---
2025-07-18 09:25:50,861 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250718_090238_sars-cov-2_05.1_create_environment.log
INFO: Virus is 'sars-cov-2'. Using Nextstrain reformatted as input.
INFO: Environment files will be saved to: environments/sars-cov-2/dist0size0
INFO: Loading data from: results/nextstrain_output/sars-cov-2/nextstrain_reformatted.tsv
INFO: Initial row count: 5,022,174
INFO: Dropped 270 rows with missing or empty 'mutations' column.
INFO: Row count after cleaning: 5,021,904
INFO: Calculating change probabilities...
INFO:   Total sequences for calculation: 5,021,904
INFO:   Found 82,050 unique mutations across all sequences.
INFO:   Finished calculating change probabilities. Shape of result: (82050, 2)
INFO: Calculating genome and variation counts per lineage...
INFO:   Found 4,452 unique lineages in the dataset.
INFO:   Finished calculating genome and variation counts.
INFO: 
Calculating 'lc_df.parquet'...
INFO: 
--- Running common logic: calculating lineage mutation frequencies ---
INFO: Selected 3333 lineages with at least 10 genomes.
INFO: Removed 0 mutations that were not characteristic of any lineage.
INFO: lc_df calculation complete.
INFO: 
Calculating 'change2lineage_probability.parquet'...
INFO: 
--- Running common logic: calculating lineage mutation frequencies ---
INFO: Selected 3333 lineages with at least 10 genomes.
INFO: change2lineage_probability calculation complete.
INFO: 
Calculating 'lc_quality_df.parquet'...
INFO: lc_quality_df calculation complete.
INFO: Saving environment files...
INFO: Virus is 'sars-cov-2'. Saving two versions of lineage characterisations.
INFO: Calculating genome and variation counts per lineage...
INFO:   Found 4,320 unique lineages in the dataset.
INFO:   Finished calculating genome and variation counts.
INFO: 
Calculating 'change2lineage_probability.parquet'...
INFO: 
--- Running common logic: calculating lineage mutation frequencies ---
INFO: Selected 3233 lineages with at least 10 genomes.
INFO: change2lineage_probability calculation complete.
INFO: 
Calculating 'lc_df.parquet'...
INFO: 
--- Running common logic: calculating lineage mutation frequencies ---
INFO: Selected 3233 lineages with at least 10 genomes.
INFO: Removed 0 mutations that were not characteristic of any lineage.
INFO: lc_df calculation complete.
INFO: Environment creation complete.

2025-07-18 09:25:50,862 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python3 src/05_prepare_recombinhunt/create_environment.py --virus sars-cov-2 --config config/config.yaml ---
2025-07-18 09:25:50,862 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python3 src/05_prepare_recombinhunt/create_samples.py --virus sars-cov-2 --config config/config.yaml ---
2025-07-18 09:25:51,534 - ERROR - --- Step FAILED: /home/topcuoglu/miniconda3/envs/orh/bin/python3 src/05_prepare_recombinhunt/create_samples.py --virus sars-cov-2 --config config/config.yaml ---
2025-07-18 09:25:51,534 - ERROR - Return Code: 1
2025-07-18 09:25:51,534 - ERROR - Stderr:

2025-07-18 09:25:51,534 - ERROR - Stdout:
INFO: Logging initialized. Log file at: logs/20250718_092551_sars-cov-2_05.2_create_samples.log
INFO: --- Starting Step 5.2: Create Samples for 'sars-cov-2' ---
INFO: Virus is 'sars-cov-2'. Using Nextstrain reformatted output as input.
INFO: Sample files will be saved to: samples/sars-cov-2/dist0size0
INFO: Loading data from: results/nextstrain_reformatted.tsv
ERROR: Input file not found: results/nextstrain_reformatted.tsv. Please run previous pipeline steps.

2025-07-18 09:25:51,534 - CRITICAL - Pipeline for 'sars-cov-2' failed at step: /home/topcuoglu/miniconda3/envs/orh/bin/python3 src/05_prepare_recombinhunt/create_samples.py --virus sars-cov-2 --config config/config.yaml
2025-07-18 09:25:51,535 - CRITICAL - Aborting pipeline for this virus.
2025-07-18 09:25:51,535 - INFO - ================== PIPELINE FOR SARS-COV-2 FINISHED ==================


