2025-08-30 11:44:46,999 - INFO - Logging initialized. Log file at: logs/20250830_114446_zika_pipeline_run.log
2025-08-30 11:44:46,999 - INFO - ================== STARTING PIPELINE FOR: ZIKA ==================
2025-08-30 11:44:46,999 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python src/01_data_acquisition/fetch_data.py --virus zika --config config/config.yaml ---
2025-08-30 11:44:54,549 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250830_114447_zika_01_fetch_data.log
INFO: Ensuring raw data directory exists: data/raw/zika
INFO: Starting NCBI data acquisition via CLI...
INFO: Step 1: Downloading main dataset...
INFO: Executing: datasets download virus genome taxon 64320 --include genome --filename zika-download.zip
INFO: Unzipping data/raw/zika/temp_complete_download/zika-download.zip...
INFO: Executing: dataformat tsv virus-genome --inputfile ncbi_dataset/data/data_report.jsonl > zika-raw-metadata.tsv
INFO: Found: data/raw/zika/temp_complete_download/ncbi_dataset/data/genomic.fna. Moving and renaming to data/raw/zika/raw_sequences.fasta
INFO: Found: data/raw/zika/temp_complete_download/zika-raw-metadata.tsv. Moving and renaming to data/raw/zika/raw_metadata.tsv
INFO: Step 3: Cleaning up temporary files...
INFO: Cleanup complete.
INFO: Step 2: Downloading reference sequence...
INFO: Fetching reference sequence from NCBI...
INFO: Executing: datasets download virus genome accession NC_035889.1 --include genome --filename zika-reference.zip
INFO: Unzipping data/raw/zika/temp_ref_download/zika-reference.zip...
INFO: Found: data/raw/zika/temp_ref_download/ncbi_dataset/data/genomic.fna. Moving and renaming to data/raw/zika/reference.fasta
INFO: Cleaning up temporary reference sequence files...
INFO: Data fetching process for 'zika' complete.

2025-08-30 11:44:54,550 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python src/01_data_acquisition/fetch_data.py --virus zika --config config/config.yaml ---
2025-08-30 11:44:54,550 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python src/02_preprocessing/ncbi/prep_metadata_ncbi.py --virus zika --config config/config.yaml ---
2025-08-30 11:44:55,370 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250830_114455_zika_02.1_prep_metadata_ncbi.log
INFO: Loading raw metadata from data/raw/zika/raw_metadata.tsv...
INFO: Step 1: Applying quality filters from config and checking for special characters in ID...
INFO:   Filter 'Isolate Collection date notna None': Removed 397 rows.
INFO:   Filter 'Accession notna None': Removed 0 rows.
INFO:   Filter 'Length notna None': Removed 0 rows.
INFO:   Filter 'Length >= 9727': Removed 930 rows.
INFO:   Filter 'Special Chars in ID': Removed 0 rows.
INFO: Step 2: Processing lineage column...
INFO: No source lineage column specified ('NONE'). Assigning default lineage 'A.1' to all rows.
INFO: Step 3: Performing final formatting on date and location columns...
INFO: Formatting date columns...
INFO:   - Analyzing and formatting 'Collection date'
INFO:     Date format statistics for 'Collection date':
INFO:       YYYY-MM-DD format: 1030
INFO:       YYYY-MM format   : 124
INFO:       YYYY format      : 108
INFO:       Other/unparseable: 0
INFO:       Missing (NA)     : 0
INFO:   - Analyzing and formatting 'Submission date'
INFO:     Date format statistics for 'Submission date':
INFO:       YYYY-MM-DD format: 0
INFO:       YYYY-MM format   : 0
INFO:       YYYY format      : 0
INFO:       Other/unparseable: 1262
INFO:       Missing (NA)     : 0
INFO: Formatting 'Location' column by combining 'Geographic Region' and 'Geographic Location'...
INFO: Preprocessing complete. Final dataset has 1262 rows.
INFO: Saving processed metadata (1262 rows) to data/processed/zika/metadata.tsv...
INFO: Saving 1327 quality-filtered sequence IDs to data/processed/zika/filtered_sequence_ids.txt...
INFO: Saving 0 non-classified sequence IDs to data/processed/zika/non_classified_sequence_ids.txt...
INFO: Script finished successfully.

2025-08-30 11:44:55,371 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python src/02_preprocessing/ncbi/prep_metadata_ncbi.py --virus zika --config config/config.yaml ---
2025-08-30 11:44:55,371 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python src/02_preprocessing/common/prep_fasta.py --virus zika --config config/config.yaml ---
2025-08-30 11:44:56,489 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250830_114456_zika_02.2_prep_fasta.log
INFO: Loading IDs of sequences to be dropped...
INFO: Loading IDs from: data/processed/zika/filtered_sequence_ids.txt
INFO: Loaded 1327 unique IDs.
INFO: Loading IDs from: data/processed/zika/non_classified_sequence_ids.txt
INFO: Loaded 0 unique IDs.
INFO: NUmber of Filtered IDs: 1327
INFO: Number of Non-Classified IDs: 0
INFO: Total unique IDs to drop from FASTA file: 1327
INFO: Filtering FASTA file: data/raw/zika/raw_sequences.fasta...
INFO: Removing sequences whose ID is in the combined dropped list (1327 total IDs).
INFO: FASTA Filtering Summary:
INFO:   Original sequences read: 2589
INFO:   Sequences dropped      : 1327
INFO:   Sequences kept         : 1262
INFO: Filtered FASTA saved to  : data/processed/zika/sequences.fasta
INFO: Script finished successfully.

2025-08-30 11:44:56,489 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python src/02_preprocessing/common/prep_fasta.py --virus zika --config config/config.yaml ---
2025-08-30 11:44:56,490 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python src/02_preprocessing/common/prep_ref.py --virus zika --config config/config.yaml ---
2025-08-30 11:44:56,601 - INFO - Stdout from step:
INFO: Logging initialized. Log file at: logs/20250830_114456_zika_02.3_prep_ref.log
INFO: Copying reference sequence...
INFO:   Source: data/raw/zika/reference.fasta
INFO:   Destination: data/processed/zika/reference.fasta
INFO: Reference sequence successfully copied to processed directory.
INFO: Script finished successfully.

2025-08-30 11:44:56,602 - INFO - --- Step Succeeded: /home/topcuoglu/miniconda3/envs/orh/bin/python src/02_preprocessing/common/prep_ref.py --virus zika --config config/config.yaml ---
2025-08-30 11:44:56,602 - INFO - --- Executing: /home/topcuoglu/miniconda3/envs/orh/bin/python src/03_haplocov/run_haplocov.py --virus zika --config config/config.yaml ---
2025-08-30 11:44:57,062 - ERROR - --- Step FAILED: /home/topcuoglu/miniconda3/envs/orh/bin/python src/03_haplocov/run_haplocov.py --virus zika --config config/config.yaml ---
2025-08-30 11:44:57,063 - ERROR - Return Code: 1
2025-08-30 11:44:57,063 - ERROR - Stderr:

2025-08-30 11:44:57,063 - ERROR - Stdout:
INFO: Logging initialized. Log file at: logs/20250830_114456_zika_03_run_haplocov.log
INFO: --- Starting Step 3: Run HaploCoV for 'zika' ---
INFO: Created temporary working directory: results/haplocov_output/zika/dist3size10/temp_work
INFO: Creating symbolic links for input files in temporary directory...
INFO: Executing HaploCoV with designation_mode: 'haplocov'
INFO: Executing: perl ../../../../../libs/haplocov/addToTableNCBI.pl --metadata metadata.tsv --ref reference.fasta --seq sequences.fasta --outfile out.HaploCoV --nproc 16
ERROR: Command failed with exit code 255
ERROR: Command: perl ../../../../../libs/haplocov/addToTableNCBI.pl --metadata metadata.tsv --ref reference.fasta --seq sequences.fasta --outfile out.HaploCoV --nproc 16
ERROR: Stderr: No novel sequences were detected in your fasta file
Execution will stop here
Your Haplocov metadata file already contains all the metadata for all the genomes in the fasta file
Or the start date you set is way far ahead in the future. Please check

ERROR: Stdout: indexing out.HaploCoV
indexing done
Now reading input metadata file
metadata read done
Now subsetting the fasta file

INFO: HaploCoV step completed.
CRITICAL: HaploCoV step failed with a critical error: Command 'perl ../../../../../libs/haplocov/addToTableNCBI.pl --metadata metadata.tsv --ref reference.fasta --seq sequences.fasta --outfile out.HaploCoV --nproc 16' returned non-zero exit status 255.
Traceback (most recent call last):
  File "/home/topcuoglu/openrecombinhunt/src/03_haplocov/run_haplocov.py", line 147, in main
    run_haplocov_step(args.virus, config)
  File "/home/topcuoglu/openrecombinhunt/src/03_haplocov/run_haplocov.py", line 110, in run_haplocov_step
    run_command(command, working_dir=temp_work_dir)
  File "/home/topcuoglu/openrecombinhunt/src/utils/utils.py", line 53, in run_command
    result = subprocess.run(
  File "/home/topcuoglu/miniconda3/envs/orh/lib/python3.10/subprocess.py", line 526, in run
    raise CalledProcessError(retcode, process.args,
subprocess.CalledProcessError: Command 'perl ../../../../../libs/haplocov/addToTableNCBI.pl --metadata metadata.tsv --ref reference.fasta --seq sequences.fasta --outfile out.HaploCoV --nproc 16' returned non-zero exit status 255.

2025-08-30 11:44:57,063 - CRITICAL - Pipeline for 'zika' failed at step: /home/topcuoglu/miniconda3/envs/orh/bin/python src/03_haplocov/run_haplocov.py --virus zika --config config/config.yaml
2025-08-30 11:44:57,063 - CRITICAL - Aborting pipeline for this virus.
2025-08-30 11:44:57,063 - INFO - ================== PIPELINE FOR ZIKA FINISHED ==================


